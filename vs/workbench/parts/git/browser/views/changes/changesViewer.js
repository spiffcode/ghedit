var __extends=this&&this.__extends||function(t,e){function n(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},__decorate=this&&this.__decorate||function(t,e,n,r){var a,o=arguments.length,i=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(i=(o<3?a(i):o>3?a(e,n,i):a(e,n))||i);return o>3&&i&&Object.defineProperty(e,n,i),i},__param=this&&this.__param||function(t,e){return function(n,r){e(n,r,t)}};define(["require","exports","vs/base/common/winjs.base","vs/nls","vs/base/common/platform","vs/base/common/paths","vs/base/common/severity","vs/base/browser/dom","vs/base/common/comparers","vs/base/browser/ui/actionbar/actionbar","vs/base/browser/ui/countBadge/countBadge","vs/base/parts/tree/browser/tree","vs/base/parts/tree/browser/treeDnd","vs/base/parts/tree/browser/treeDefaults","vs/workbench/parts/git/common/git","vs/workbench/parts/git/common/gitModel","vs/workbench/parts/git/browser/gitActions","vs/platform/contextview/browser/contextView","vs/platform/instantiation/common/instantiation","vs/platform/message/common/message","vs/base/common/keyCodes","vs/platform/workspace/common/workspace","vs/base/common/uri"],function(t,e,n,r,a,o,i,s,c,u,l,p,d,f,E,g,h,S,D,T,y,_,m){/*---------------------------------------------------------------------------------------------
     *  Copyright (c) Microsoft Corporation. All rights reserved.
     *  Licensed under the MIT License. See License.txt in the project root for license information.
     *--------------------------------------------------------------------------------------------*/
"use strict";function v(t){return a.isWindows?t.replace(/\//g,"\\"):t}var R=E.IGitService,A=s.emmet,I=function(){function t(t){this.cache={},this.instantiationService=t}return t.prototype.getAction=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];var r=this.cache[t.ID];return r||(e.unshift(t),r=this.cache[t.ID]=this.instantiationService.createInstance.apply(this.instantiationService,e)),r},t.prototype.dispose=function(){var t=this;Object.keys(this.cache).forEach(function(e){t.cache[e].dispose()}),this.cache=null},t}();e.ActionContainer=I;var C=function(){function t(){}return t.prototype.getId=function(t,e){if(e instanceof g.StatusModel)return"root";if(e instanceof g.StatusGroup){var n=e;switch(n.getType()){case E.StatusType.INDEX:return"index";case E.StatusType.WORKING_TREE:return"workingTree";case E.StatusType.MERGE:return"merge";default:throw new Error("Invalid group type")}}var r=e;return r.getId()},t.prototype.hasChildren=function(t,e){if(e instanceof g.StatusModel)return!0;if(e instanceof g.StatusGroup){var n=e;return n.all().length>0}},t.prototype.getChildren=function(t,e){if(e instanceof g.StatusModel){var r=e;return n.TPromise.as(r.getGroups())}if(e instanceof g.StatusGroup){var a=e;return n.TPromise.as(a.all())}return n.TPromise.as([])},t.prototype.getParent=function(t,e){return n.TPromise.as(null)},t}();e.DataSource=C;var b=function(t){function e(e,n){t.call(this,e),this.gitService=n}return __extends(e,t),e.prototype.hasActions=function(t,e){return e instanceof g.FileStatus||e instanceof g.StatusGroup&&e.all().length>0},e.prototype.getActions=function(t,e){return e instanceof g.StatusGroup?n.TPromise.as(this.getActionsForGroupStatusType(e.getType())):n.TPromise.as(this.getActionsForFileStatusType(e.getType()))},e.prototype.getActionsForFileStatusType=function(t){switch(t){case E.StatusType.INDEX:return[this.getAction(h.UnstageAction)];case E.StatusType.WORKING_TREE:return[this.getAction(h.UndoAction),this.getAction(h.StageAction)];case E.StatusType.MERGE:return[this.getAction(h.StageAction)];default:return[]}},e.prototype.getActionsForGroupStatusType=function(t){switch(t){case E.StatusType.INDEX:return[this.getAction(h.GlobalUnstageAction)];case E.StatusType.WORKING_TREE:return[this.getAction(h.GlobalUndoAction),this.getAction(h.GlobalStageAction)];case E.StatusType.MERGE:return[this.getAction(h.StageAction)];default:return[]}},e.prototype.hasSecondaryActions=function(t,e){return this.hasActions(t,e)},e.prototype.getSecondaryActions=function(t,e){var n=this;return this.getActions(t,e).then(function(t){if(e instanceof g.FileStatus){var r=e,a=r.getStatus();t.push(new u.Separator),a!==E.Status.DELETED&&a!==E.Status.INDEX_DELETED&&t.push(n.getAction(h.OpenFileAction)),t.push(n.getAction(h.OpenChangeAction))}return t.reverse(),t})},e.prototype.getActionItem=function(t,e,n){return null},e=__decorate([__param(0,D.IInstantiationService),__param(1,R)],e)}(I);e.ActionProvider=b;var O=function(){function t(t,e,n,r,a){this.actionProvider=t,this.actionRunner=e,this.messageService=n,this.gitService=r,this.contextService=a}return t.prototype.getHeight=function(t,e){return 22},t.prototype.getTemplateId=function(t,e){if(e instanceof g.StatusGroup)switch(e.getType()){case E.StatusType.INDEX:return"index";case E.StatusType.WORKING_TREE:return"workingTree";case E.StatusType.MERGE:return"merge"}if(e instanceof g.FileStatus)switch(e.getType()){case E.StatusType.INDEX:return"file:index";case E.StatusType.WORKING_TREE:return"file:workingTree";case E.StatusType.MERGE:return"file:merge"}return null},t.prototype.renderTemplate=function(e,n,r){return/^file:/.test(n)?this.renderFileStatusTemplate(t.templateIdToStatusType(n),r):this.renderStatusGroupTemplate(t.templateIdToStatusType(n),r)},t.prototype.renderStatusGroupTemplate=function(t,e){var n=this,a=Object.create(null);switch(a.root=s.append(e,A(".status-group")),t){case E.StatusType.INDEX:a.root.textContent=r.localize("stagedChanges","Staged Changes");break;case E.StatusType.WORKING_TREE:a.root.textContent=r.localize("allChanges","Changes");break;case E.StatusType.MERGE:a.root.textContent=r.localize("mergeChanges","Merge Changes")}var o=s.append(e,A(".count-badge-wrapper"));return a.count=new l.CountBadge(o),a.actionBar=new u.ActionBar(e,{actionRunner:this.actionRunner}),a.actionBar.push(this.actionProvider.getActionsForGroupStatusType(t),{icon:!0,label:!1}),a.actionBar.addListener2("run",function(t){return t.error&&n.onError(t.error)}),a},t.prototype.renderFileStatusTemplate=function(t,e){var n=this,r=Object.create(null);r.root=s.append(e,A(".file-status")),r.status=s.append(r.root,A("span.status")),r.name=s.append(r.root,A("a.name.plain")),r.folder=s.append(r.root,A("span.folder"));var a=s.append(r.root,A("span.rename")),o=s.append(a,A("span.rename-arrow"));return o.textContent="â†",r.renameName=s.append(a,A("span.rename-name")),r.renameFolder=s.append(a,A("span.rename-folder")),r.actionBar=new u.ActionBar(e,{actionRunner:this.actionRunner}),r.actionBar.push(this.actionProvider.getActionsForFileStatusType(t),{icon:!0,label:!1}),r.actionBar.addListener2("run",function(t){return t.error&&n.onError(t.error)}),r},t.prototype.renderElement=function(e,n,r,a){/^file:/.test(r)?this.renderFileStatus(e,n,a):t.renderStatusGroup(n,a)},t.renderStatusGroup=function(t,e){e.actionBar.context=t,e.count.setCount(t.all().length)},t.prototype.renderFileStatus=function(e,n,a){a.actionBar.context={tree:e,fileStatus:n};var i=this.gitService.getModel().getRepositoryRoot(),s=this.contextService.getWorkspace().resource.fsPath,c=n.getStatus(),u=n.getRename(),l=n.getPath(),p=l.lastIndexOf("/"),d=p===-1?l:l.substr(p+1,l.length),f=p===-1?"":l.substr(0,p);a.root.className="file-status "+t.statusToClass(c),a.status.textContent=t.statusToChar(c),a.status.title=t.statusToTitle(c);var E=m["default"].file(o.normalize(o.join(i,l))),g=o.isEqualOrParent(E.fsPath,s),h="",S="";if(u){var D=u.lastIndexOf("/");h=D===-1?u:u.substr(D+1,u.length),S=D===-1?"":u.substr(0,D),a.renameName.textContent=d,a.renameFolder.textContent=f;var T=m["default"].file(o.normalize(o.join(i,u)));g=o.isEqualOrParent(T.fsPath,s)}g?a.root.title="":(a.root.title=r.localize("outsideOfWorkspace","This file is located outside the current workspace."),a.root.className+=" out-of-workspace"),a.name.textContent=h||d,a.name.title=u||l,a.folder.textContent=v(S||f)},t.prototype.disposeTemplate=function(e,n,r){/^file:/.test(n)&&t.disposeFileStatusTemplate(r)},t.disposeFileStatusTemplate=function(t){t.actionBar.dispose()},t.statusToChar=function(t){switch(t){case E.Status.INDEX_MODIFIED:return r.localize("modified-char","M");case E.Status.MODIFIED:return r.localize("modified-char","M");case E.Status.INDEX_ADDED:return r.localize("added-char","A");case E.Status.INDEX_DELETED:return r.localize("deleted-char","D");case E.Status.DELETED:return r.localize("deleted-char","D");case E.Status.INDEX_RENAMED:return r.localize("renamed-char","R");case E.Status.INDEX_COPIED:return r.localize("copied-char","C");case E.Status.UNTRACKED:return r.localize("untracked-char","U");case E.Status.IGNORED:return r.localize("ignored-char","!");case E.Status.BOTH_DELETED:return r.localize("deleted-char","D");case E.Status.ADDED_BY_US:return r.localize("added-char","A");case E.Status.DELETED_BY_THEM:return r.localize("deleted-char","D");case E.Status.ADDED_BY_THEM:return r.localize("added-char","A");case E.Status.DELETED_BY_US:return r.localize("deleted-char","D");case E.Status.BOTH_ADDED:return r.localize("added-char","A");case E.Status.BOTH_MODIFIED:return r.localize("modified-char","M");default:return""}},t.statusToTitle=function(t){switch(t){case E.Status.INDEX_MODIFIED:return r.localize("title-index-modified","Modified in index");case E.Status.MODIFIED:return r.localize("title-modified","Modified");case E.Status.INDEX_ADDED:return r.localize("title-index-added","Added to index");case E.Status.INDEX_DELETED:return r.localize("title-index-deleted","Deleted in index");case E.Status.DELETED:return r.localize("title-deleted","Deleted");case E.Status.INDEX_RENAMED:return r.localize("title-index-renamed","Renamed in index");case E.Status.INDEX_COPIED:return r.localize("title-index-copied","Copied in index");case E.Status.UNTRACKED:return r.localize("title-untracked","Untracked");case E.Status.IGNORED:return r.localize("title-ignored","Ignored");case E.Status.BOTH_DELETED:return r.localize("title-conflict-both-deleted","Conflict: both deleted");case E.Status.ADDED_BY_US:return r.localize("title-conflict-added-by-us","Conflict: added by us");case E.Status.DELETED_BY_THEM:return r.localize("title-conflict-deleted-by-them","Conflict: deleted by them");case E.Status.ADDED_BY_THEM:return r.localize("title-conflict-added-by-them","Conflict: added by them");case E.Status.DELETED_BY_US:return r.localize("title-conflict-deleted-by-us","Conflict: deleted by us");case E.Status.BOTH_ADDED:return r.localize("title-conflict-both-added","Conflict: both added");case E.Status.BOTH_MODIFIED:return r.localize("title-conflict-both-modified","Conflict: both modified");default:return""}},t.statusToClass=function(t){switch(t){case E.Status.INDEX_MODIFIED:return"modified";case E.Status.MODIFIED:return"modified";case E.Status.INDEX_ADDED:return"added";case E.Status.INDEX_DELETED:return"deleted";case E.Status.DELETED:return"deleted";case E.Status.INDEX_RENAMED:return"renamed";case E.Status.INDEX_COPIED:return"copied";case E.Status.UNTRACKED:return"untracked";case E.Status.IGNORED:return"ignored";case E.Status.BOTH_DELETED:return"conflict both-deleted";case E.Status.ADDED_BY_US:return"conflict added-by-us";case E.Status.DELETED_BY_THEM:return"conflict deleted-by-them";case E.Status.ADDED_BY_THEM:return"conflict added-by-them";case E.Status.DELETED_BY_US:return"conflict deleted-by-us";case E.Status.BOTH_ADDED:return"conflict both-added";case E.Status.BOTH_MODIFIED:return"conflict both-modified";default:return""}},t.templateIdToStatusType=function(t){return/index$/.test(t)?E.StatusType.INDEX:/workingTree$/.test(t)?E.StatusType.WORKING_TREE:E.StatusType.MERGE},t.prototype.onError=function(t){this.messageService.show(i["default"].Error,t)},t=__decorate([__param(2,T.IMessageService),__param(3,R),__param(4,_.IWorkspaceContextService)],t)}();e.Renderer=O;var G=function(){function t(){}return t.prototype.isVisible=function(t,e){if(e instanceof g.StatusGroup){var n=e;switch(n.getType()){case E.StatusType.INDEX:case E.StatusType.MERGE:return n.all().length>0;case E.StatusType.WORKING_TREE:return!0}}return!0},t}();e.Filter=G;var N=function(){function t(){}return t.prototype.compare=function(e,n,r){return n instanceof g.FileStatus&&r instanceof g.FileStatus?t.compareStatus(n,r):0},t.compareStatus=function(t,e){for(var n,r,a,o,i=t.getPathComponents(),s=e.getPathComponents(),u=i.length-1,l=s.length-1,p=0;;p++){if(n=u===p,r=l===p,n&&r)return c.compareFileNames(i[p],s[p]);if(n)return-1;if(r)return 1;if((a=i[p].toLowerCase())!==(o=s[p].toLowerCase()))return a<o?-1:1}},t}();e.Sorter=N;var w=function(t){function e(e,n,r){t.call(this,e),this.gitService=n,this.messageService=r}return __extends(e,t),e.prototype.getDragURI=function(t,e){if(e instanceof g.StatusGroup){var n=e;return"git:"+n.getType()}if(e instanceof g.FileStatus){var r=e;return"git:"+r.getType()+":"+r.getPath()}return null},e.prototype.onDragStart=function(t,e,n){},e.prototype.onDragOver=function(t,e,n,r){if(!this.gitService.isIdle())return p.DRAG_OVER_REJECT;if(!(e instanceof d.ElementsDragAndDropData))return p.DRAG_OVER_REJECT;var a=e.getData(),o=a[0];if(o instanceof g.StatusGroup){var i=o;return this.onDrag(n,i.getType())}if(o instanceof g.FileStatus){var s=o;return this.onDrag(n,s.getType())}return p.DRAG_OVER_REJECT},e.prototype.onDrag=function(t,e){return e===E.StatusType.WORKING_TREE?this.onDragWorkingTree(t):e===E.StatusType.INDEX?this.onDragIndex(t):e===E.StatusType.MERGE?this.onDragMerge(t):p.DRAG_OVER_REJECT},e.prototype.onDragWorkingTree=function(t){if(t instanceof g.StatusGroup){var e=t;return e.getType()===E.StatusType.INDEX?p.DRAG_OVER_ACCEPT_BUBBLE_DOWN:p.DRAG_OVER_REJECT}if(t instanceof g.FileStatus){var n=t;return n.getType()===E.StatusType.INDEX?p.DRAG_OVER_ACCEPT_BUBBLE_UP:p.DRAG_OVER_REJECT}return p.DRAG_OVER_REJECT},e.prototype.onDragIndex=function(t){if(t instanceof g.StatusGroup){var e=t;return e.getType()===E.StatusType.WORKING_TREE?p.DRAG_OVER_ACCEPT_BUBBLE_DOWN:p.DRAG_OVER_REJECT}if(t instanceof g.FileStatus){var n=t;return n.getType()===E.StatusType.WORKING_TREE?p.DRAG_OVER_ACCEPT_BUBBLE_UP:p.DRAG_OVER_REJECT}return p.DRAG_OVER_REJECT},e.prototype.onDragMerge=function(t){if(t instanceof g.StatusGroup){var e=t;return e.getType()===E.StatusType.INDEX?p.DRAG_OVER_ACCEPT_BUBBLE_DOWN:p.DRAG_OVER_REJECT}if(t instanceof g.FileStatus){var n=t;return n.getType()===E.StatusType.INDEX?p.DRAG_OVER_ACCEPT_BUBBLE_UP:p.DRAG_OVER_REJECT}return p.DRAG_OVER_REJECT},e.prototype.drop=function(t,e,n,r){var a,o=this,i=e.getData(),s=i[0];a=s instanceof g.StatusGroup?s.all():i;var c=n;c.getType()===E.StatusType.INDEX&&this.getAction(h.StageAction).run(a).done(null,function(t){return o.onError(t)}),c.getType()===E.StatusType.WORKING_TREE&&this.getAction(h.UnstageAction).run(a).done(null,function(t){return o.onError(t)})},e.prototype.onError=function(t){this.messageService.show(i["default"].Error,t)},e=__decorate([__param(0,D.IInstantiationService),__param(1,R),__param(2,T.IMessageService)],e)}(I);e.DragAndDrop=w;var B=function(){function t(){}return t.prototype.getAriaLabel=function(t,e){if(e instanceof g.FileStatus){var n=e,a=n.getStatus(),o=n.getPath(),i=o.lastIndexOf("/"),s=i===-1?o:o.substr(i+1,o.length),c=i===-1?"":o.substr(0,i);return r.localize("fileStatusAriaLabel","File {0} in folder {1} has status: {2}, Git",s,c,O.statusToTitle(a))}if(e instanceof g.StatusGroup)switch(e.getType()){case E.StatusType.INDEX:return r.localize("ariaLabelStagedChanges","Staged Changes, Git");case E.StatusType.WORKING_TREE:return r.localize("ariaLabelChanges","Changes, Git");case E.StatusType.MERGE:return r.localize("ariaLabelMerge","Merge, Git")}},t}();e.AccessibilityProvider=B;var F=function(t){function e(e,n){t.call(this,{clickBehavior:f.ClickBehavior.ON_MOUSE_UP}),this.actionProvider=e,this.contextMenuService=n,this.downKeyBindingDispatcher.set(y.CommonKeybindings.SHIFT_UP_ARROW,this.onUp.bind(this)),this.downKeyBindingDispatcher.set(y.CommonKeybindings.SHIFT_DOWN_ARROW,this.onDown.bind(this)),this.downKeyBindingDispatcher.set(y.CommonKeybindings.SHIFT_PAGE_UP,this.onPageUp.bind(this)),this.downKeyBindingDispatcher.set(y.CommonKeybindings.SHIFT_PAGE_DOWN,this.onPageDown.bind(this))}return __extends(e,t),e.prototype.onLeftClick=function(e,n,r){if(n instanceof g.StatusGroup)return r.preventDefault(),r.stopPropagation(),!0;if(r.shiftKey){var o=e.getFocus();if(!(o instanceof g.FileStatus&&n instanceof g.FileStatus))return;var i=o,s=n;if(i.getType()!==s.getType())return;return void(this.canSelect(e,n)&&(e.setFocus(n),e.isSelected(n)?e.deselectRange(i,s):e.selectRange(i,s)))}return e.setFocus(n),(a.isMacintosh?r.metaKey:r.ctrlKey)?void(this.canSelect(e,n)&&e.toggleSelection(n,{origin:"mouse",originalEvent:r})):t.prototype.onLeftClick.call(this,e,n,r)},e.prototype.onEnter=function(e,n){var r=e.getFocus();return r instanceof g.StatusGroup?(n.preventDefault(),n.stopPropagation(),!0):t.prototype.onEnter.call(this,e,n)},e.prototype.onSpace=function(t,e){var n=t.getFocus();return n?!!this.canSelect(t,n)&&(t.toggleSelection(n,{origin:"keyboard",originalEvent:e}),e.preventDefault(),e.stopPropagation(),!0):(e.preventDefault(),e.stopPropagation(),!0)},e.prototype.onContextMenu=function(t,e,n){var r=this;if(n.target&&n.target.tagName&&"input"===n.target.tagName.toLowerCase())return!1;if(n.preventDefault(),n.stopPropagation(),t.setFocus(e),this.actionProvider.hasSecondaryActions(t,e)){var a={x:n.posx+1,y:n.posy},o={selection:t.getSelection(),focus:e};return this.contextMenuService.showContextMenu({getAnchor:function(){return a},getActions:function(){return r.actionProvider.getSecondaryActions(t,e)},getActionItem:this.actionProvider.getActionItem.bind(this.actionProvider,t,e),getActionsContext:function(){return o},onHide:function(e){e&&t.DOMFocus()}}),!0}return!1},e.prototype.onLeft=function(t,e){return!0},e.prototype.onRight=function(t,e){return!0},e.prototype.onUp=function(e,n){var r=e.getFocus(),a=t.prototype.onUp.call(this,e,n);return!(!a||!n.shiftKey)&&this.shiftSelect(e,r,n)},e.prototype.onPageUp=function(e,n){var r=e.getFocus(),a=t.prototype.onPageUp.call(this,e,n);return!(!a||!n.shiftKey)&&this.shiftSelect(e,r,n)},e.prototype.onDown=function(e,n){var r=e.getFocus(),a=t.prototype.onDown.call(this,e,n);return!(!a||!n.shiftKey)&&this.shiftSelect(e,r,n)},e.prototype.onPageDown=function(e,n){var r=e.getFocus(),a=t.prototype.onPageDown.call(this,e,n);return!(!a||!n.shiftKey)&&this.shiftSelect(e,r,n)},e.prototype.canSelect=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];return!e.some(function(t){return t instanceof g.StatusGroup||t instanceof g.StatusModel})&&e.every(function(e){var n=t.getSelection()[0],r=e;return!n||n.getType()===r.getType()})},e.prototype.shiftSelect=function(t,e,n){var r={origin:"keyboard",originalEvent:n},a=t.getFocus();if(a===e)return!1;var o=t.isSelected(e),i=t.isSelected(a);return o&&i?t.deselectRange(a,e,r):o||i?o?this.canSelect(t,a)&&t.selectRange(a,e,r):t.deselectRange(a,e,r):this.canSelect(t,e,a)&&t.selectRange(a,e,r),!0},e=__decorate([__param(1,S.IContextMenuService)],e)}(f.DefaultController);e.Controller=F});