{"version":3,"file":"vs/editor/common/modes/textToHtmlTokenizer.js","sourceRoot":"file:///Users/darrin/src/vscode/src","sources":["vs/editor/common/modes/textToHtmlTokenizer.ts"],"names":[],"mappings":"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","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n'use strict';\n\nimport {IHTMLContentElement} from 'vs/base/common/htmlContent';\nimport * as strings from 'vs/base/common/strings';\nimport {IMode, IState, ITokenizationSupport} from 'vs/editor/common/modes';\nimport {NullState, nullTokenize} from 'vs/editor/common/modes/nullMode';\n\nexport function tokenizeToHtmlContent(text: string, mode: IMode): IHTMLContentElement {\n\treturn _tokenizeToHtmlContent(text, _getSafeTokenizationSupport(mode));\n}\n\nexport function tokenizeToString(text: string, mode: IMode, extraTokenClass?: string): string {\n\treturn _tokenizeToString(text, _getSafeTokenizationSupport(mode), extraTokenClass);\n}\n\nfunction _getSafeTokenizationSupport(mode: IMode): ITokenizationSupport {\n\tif (mode && mode.tokenizationSupport) {\n\t\treturn mode.tokenizationSupport;\n\t}\n\treturn {\n\t\tshouldGenerateEmbeddedModels: false,\n\t\tgetInitialState: () => new NullState(null, null),\n\t\ttokenize: (buffer:string, state: IState, deltaOffset:number = 0, stopAtOffset?:number) => nullTokenize(null, buffer, state, deltaOffset, stopAtOffset)\n\t};\n}\n\nfunction _tokenizeToHtmlContent(text: string, tokenizationSupport: ITokenizationSupport): IHTMLContentElement {\n\tvar result: IHTMLContentElement = {\n\t\ttagName: 'div',\n\t\tstyle: 'white-space: pre-wrap',\n\t\tchildren: []\n\t};\n\n\tvar emitToken = (className: string, tokenText: string) => {\n\t\tresult.children.push({\n\t\t\ttagName: 'span',\n\t\t\tclassName: className,\n\t\t\ttext: tokenText\n\t\t});\n\t};\n\n\tvar emitNewLine = () => {\n\t\tresult.children.push({\n\t\t\ttagName: 'br'\n\t\t});\n\t};\n\n\t_tokenizeLines(text, tokenizationSupport, emitToken, emitNewLine);\n\n\treturn result;\n}\n\nfunction _tokenizeToString(text: string, tokenizationSupport: ITokenizationSupport, extraTokenClass: string = ''): string {\n\tif (extraTokenClass && extraTokenClass.length > 0) {\n\t\textraTokenClass = ' ' + extraTokenClass;\n\t}\n\n\tvar result = '';\n\n\tvar emitToken = (className: string, tokenText: string) => {\n\t\tresult += '<span class=\"' + className + extraTokenClass + '\">' + strings.escape(tokenText) + '</span>';\n\t};\n\n\tvar emitNewLine = () => {\n\t\tresult += '<br/>';\n\t};\n\n\tresult = '<div style=\"white-space: pre-wrap;\">';\n\t_tokenizeLines(text, tokenizationSupport, emitToken, emitNewLine);\n\tresult += '</div>';\n\n\treturn result;\n}\n\ninterface IEmitTokenFunc {\n\t(className: string, innerText: string): void;\n}\ninterface IEmitNewLineFunc {\n\t(): void;\n}\n\nfunction _tokenizeLines(text: string, tokenizationSupport: ITokenizationSupport, emitToken: IEmitTokenFunc, emitNewLine: IEmitNewLineFunc): void {\n\tvar lines = text.split(/\\r\\n|\\r|\\n/);\n\tvar currentState = tokenizationSupport.getInitialState();\n\tfor (var i = 0; i < lines.length; i++) {\n\t\tcurrentState = _tokenizeLine(lines[i], tokenizationSupport, emitToken, currentState);\n\n\t\t// Keep new lines\n\t\tif (i < lines.length - 1) {\n\t\t\temitNewLine();\n\t\t}\n\t}\n}\n\nfunction _tokenizeLine(line: string, tokenizationSupport:ITokenizationSupport, emitToken: IEmitTokenFunc, startState: IState): IState {\n\tvar tokenized = tokenizationSupport.tokenize(line, startState),\n\t\tendState = tokenized.endState,\n\t\ttokens = tokenized.tokens,\n\t\toffset = 0,\n\t\ttokenText: string;\n\n\t// For each token inject spans with proper class names based on token type\n\tfor (var j = 0; j < tokens.length; j++) {\n\t\tvar token = tokens[j];\n\n\t\t// Tokens only provide a startIndex from where they are valid from. As such, we need to\n\t\t// look ahead the value of the token by advancing until the next tokens start inex or the\n\t\t// end of the line.\n\t\tif (j < tokens.length - 1) {\n\t\t\ttokenText = line.substring(offset, tokens[j + 1].startIndex);\n\t\t\toffset = tokens[j + 1].startIndex;\n\t\t} else {\n\t\t\ttokenText = line.substr(offset);\n\t\t}\n\n\t\tvar className = 'token';\n\t\tvar safeType = token.type.replace(/[^a-z0-9\\-]/gi, ' ');\n\t\tif (safeType.length > 0) {\n\t\t\tclassName += ' ' + safeType;\n\t\t}\n\t\temitToken(className, tokenText);\n\t}\n\n\treturn endState;\n}\n"]}